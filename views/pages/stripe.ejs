<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta http-equiv="X-UA-Compatible" content="ie=edge" />
		<link href="https://unpkg.com/tailwindcss@^1.0/dist/tailwind.min.css" rel="stylesheet" />
		<title>Stripe Node App</title>
	</head>
	<body class="">
		<div class="flex justify-center mt-32">
			<form action="/create-checkout-session" method="POST" class="flex flex-col w-1/3">
				<input class="bg-transparent text-white p-2 h-10 mb-4" type="text" name="name" placeholder="Name" />
				<input type="email" class="bg-transparent text-white p-2 h-10 mb-4" name="email" placeholder="Email" />
				<input class="bg-transparent text-white p-2 h-10 mb-4" type="text" name="amount" placeholder="Amount" />
				<div id="card-element" class="bg-transparent text-white p-2 h-10 mb-4"></div>
				<div id="card-errors" role="alert"></div>
				<button class="text-white bg-blue-400 p-4 rounded">Submit Payment</button>
			</form>
		</div>
	</body>
	<script>
		const stripe = require("stripe")(process.env.STRIPE_PUBLISH_KEY);
		const elements = stripe.elements();
		var style = {
			base: {
				color: "#fff",
			},
		};
		const card = elements.create("card", { style });
		card.mount("#card-element");
		const form = document.querySelector("form");
		const errorEl = document.querySelector("#card-errors");
		const stripeTokenHandler = (token) => {
			const hiddenInput = document.createElement("input");
			hiddenInput.setAttribute("type", "hidden");
			hiddenInput.setAttribute("name", "stripeToken");
			hiddenInput.setAttribute("value", token.id);
			form.appendChild(hiddenInput);
			console.log(form);
			form.submit();
		};
		form.addEventListener("submit", (e) => {
			e.preventDefault();
			stripe.createToken(card).then((res) => {
				if (res.error) errorEl.textContent = res.error.message;
				else {
					console.log(res.token);
					stripeTokenHandler(res.token);
				}
			});
		});
	</script>
</html>
